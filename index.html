<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OVA 2: Simple Present for Routines</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    body{font-family:'Poppins',sans-serif}
    .sidebar-link{transition:all .3s ease;border-left:4px solid transparent}
    .sidebar-link.active,.sidebar-link:hover{background:#e6f4ea;color:#166534;border-left-color:#22c55e}
    .content-pane{display:none;animation:fadeIn .5s ease-in-out}
    .content-pane.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .quiz-option:hover{background:#f0fdf4}
    .quiz-option.selected{background:#dcfce7;border-color:#22c55e}
    .drag-item{cursor:grab}
    .drop-zone{min-height:48px}
    .drop-zone.filled{background:#ecfdf5}
    .sortable-token{cursor:grab}
    .token-bin{min-height:52px}
    .speak-btn{transition:transform .08s ease}
    .speak-btn:active{transform:scale(.92)}
    .pill{border:1px dashed #86efac}
    .tag{border:1px solid #d1fae5}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    code{background:#f1f5f9;padding:.1rem .35rem;border-radius:.35rem}
    /* Estilos para el sidebar estÃ¡tico */
    .sticky-sidebar {
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      z-index: 10;
    }
    
    /* Scrollbar personalizado para el sidebar */
    .sticky-sidebar::-webkit-scrollbar {
      width: 6px;
    }
    
    .sticky-sidebar::-webkit-scrollbar-track {
      background: #f1f5f9;
    }
    
    .sticky-sidebar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    
    .sticky-sidebar::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

  </style>
</head>
<body class="bg-slate-50">

<div class="flex min-h-screen">
  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-lg flex-shrink-0 hidden md:flex md:flex-col sticky-sidebar"> 
    <div class="p-4">
      <div style="width:150px;height:150px" class="p-2 mx-auto flex items-center justify-center bg-white rounded-full shadow-lg border-2 border-green-500">
        <img src="img/logo.webp" alt="Logo OVA" class="w-5/6 h-5/6 object-contain" loading="lazy">
      </div>
    </div>
    <nav class="mt-6 flex-1">
      <a href="#" class="sidebar-link active flex items-center py-3 px-6 font-medium text-slate-700" data-target="introduccion"><span class="mr-3 text-xl">ğŸš€</span> IntroducciÃ³n</a>
      <a href="#" class="sidebar-link flex items-center py-3 px-6 font-medium text-slate-700" data-target="objetivos"><span class="mr-3 text-xl">ğŸ¯</span> Objetivos</a>
      <a href="#" class="sidebar-link flex items-center py-3 px-6 font-medium text-slate-700" data-target="contenido"><span class="mr-3 text-xl">ğŸ“š</span> Contenido</a>
      <a href="#" class="sidebar-link flex items-center py-3 px-6 font-medium text-slate-700" data-target="actividades"><span class="mr-3 text-xl">âœï¸</span> Actividades</a>
      <a href="#" class="sidebar-link flex items-center py-3 px-6 font-medium text-slate-700" data-target="evaluacion"><span class="mr-3 text-xl">âœ”ï¸</span> EvaluaciÃ³n</a>
      <a href="#" class="sidebar-link flex items-center py-3 px-6 font-medium text-slate-700" data-target="recursos"><span class="mr-3 text-xl">ğŸ“–</span> Recursos</a>
      <a href="#" class="sidebar-link flex items-center py-3 px-6 font-medium text-slate-700" data-target="bibliografia"><span class="mr-3 text-xl">ğŸ“š</span> BibliografÃ­a</a>
    </nav>
  </aside>

  <!-- Main -->
  <main class="flex-1 p-4 sm:p-6 md:p-10 bg-gray-50">
    <!-- Mobile header -->
    <div class="md:hidden mb-6">
      <select id="mobile-nav" class="w-full p-2 border rounded-md bg-white shadow-sm">
        <option value="introduccion">ğŸš€ IntroducciÃ³n</option>
        <option value="objetivos">ğŸ¯ Objetivos</option>
        <option value="contenido">ğŸ“š Contenido</option>
        <option value="actividades">âœï¸ Actividades</option>
        <option value="evaluacion">âœ”ï¸ EvaluaciÃ³n</option>
        <option value="recursos">ğŸ“– Recursos</option>
        <option value="bibliografia">ğŸ“š BibliografÃ­a</option>
      </select>
    </div>

    <!-- IntroducciÃ³n -->
    <section id="introduccion" class="content-pane active">
      <h2 class="text-2xl sm:text-3xl font-bold text-green-800 mb-4">Simple Present for Routines</h2>
      <p class="text-slate-700 leading-relaxed mb-4">
        En este OVA aprenderÃ¡s a usar el <b>presente simple</b> para hablar de tus <b>rutinas</b>. Te servirÃ¡ para decir quÃ© haces
        cada dÃ­a en MonterÃ­a, Lorica, SahagÃºn, BerÃ¡stegui o MontelÃ­bano: ir a clase, estudiar programaciÃ³n, revisar el correo
        y mÃ¡s. PracticarÃ¡s con explicaciones claras, pronunciaciÃ³n con audio ğŸ”Š, ejercicios interactivos y una evaluaciÃ³n amplia.
      </p>
      <div class="p-4 sm:p-6 bg-green-50 border-l-4 border-green-500 rounded-r-lg text-green-900">
        ğŸ’¡ <b>Idea clave:</b> Usa <code>do/does</code> para preguntas, <code>donâ€™t/doesnâ€™t</code> para negar y recuerda agregar <code>-s/-es/-ies</code> a la tercera persona (he, she, it).
      </div>
    </section>

    <!-- Objetivos -->
    <section id="objetivos" class="content-pane">
      <h2 class="text-2xl sm:text-3xl font-bold text-green-800 mb-6">Objetivos de aprendizaje</h2>
      <ul class="space-y-4">
        <li class="flex items-start p-4 bg-white rounded-lg shadow-sm"><span class="mr-3 text-2xl text-green-700">ğŸ§ </span><span>Comprender la forma afirmativa, negativa e interrogativa del presente simple.</span></li>
        <li class="flex items-start p-4 bg-white rounded-lg shadow-sm"><span class="mr-3 text-2xl text-green-700">ğŸ§©</span><span>Aplicar la regla de tercera persona: <code>-s</code>, <code>-es</code>, <code>-ies</code>.</span></li>
        <li class="flex items-start p-4 bg-white rounded-lg shadow-sm"><span class="mr-3 text-2xl text-green-700">ğŸ—£ï¸</span><span>Formular y responder preguntas sobre la rutina.</span></li>
        <li class="flex items-start p-4 bg-white rounded-lg shadow-sm"><span class="mr-3 text-2xl text-green-700">ğŸ§ª</span><span>Resolver actividades interactivas con retroalimentaciÃ³n inmediata y completar una evaluaciÃ³n integral.</span></li>
      </ul>
    </section>

    <!-- Contenido -->
    <section id="contenido" class="content-pane">
      <h2 class="text-2xl sm:text-3xl font-bold text-green-800 mb-6">Contenido</h2>

      <div class="mb-6">
        <h3 class="text-xl font-bold text-green-700 mb-2">1) Forma afirmativa</h3>
        <p class="text-slate-700 mb-2">
          <b>Estructura:</b> Sujeto + verbo base (+ <code>-s/-es/-ies</code> en <i>he/she/it</i>) + complemento.
        </p>
        <ul class="grid sm:grid-cols-2 gap-3">
          <li class="p-3 bg-white rounded border flex items-center justify-between">
            <span><b>I</b> study programming at night.</span>
            <button class="speak-btn bg-green-600 text-white rounded px-3 py-1" onclick="speak('I study programming at night')">ğŸ”Š</button>
          </li>
          <li class="p-3 bg-white rounded border flex items-center justify-between">
            <span><b>She</b> <u>studies</u> in Lorica.</span>
            <button class="speak-btn bg-green-600 text-white rounded px-3 py-1" onclick="speak('She studies in Lorica')">ğŸ”Š</button>
          </li>
          <li class="p-3 bg-white rounded border flex items-center justify-between">
            <span><b>He</b> <u>goes</u> to class in SahagÃºn.</span>
            <button class="speak-btn bg-green-600 text-white rounded px-3 py-1" onclick="speak('He goes to class in Sahagun')">ğŸ”Š</button>
          </li>
          <li class="p-3 bg-white rounded border flex items-center justify-between">
            <span><b>It</b> <u>ends</u> at noon.</span>
            <button class="speak-btn bg-green-600 text-white rounded px-3 py-1" onclick="speak('It ends at noon')">ğŸ”Š</button>
          </li>
        </ul>
        <div class="mt-3 text-slate-600 text-sm">
          ğŸ” Reglas: <b>add -s</b> (workâ†’works), <b>-es</b> (goâ†’goes), <b>-ies</b> (studyâ†’studies).
        </div>
      </div>

      <div class="mb-6">
        <h3 class="text-xl font-bold text-green-700 mb-2">2) Forma negativa</h3>
        <p class="text-slate-700 mb-2"><b>Estructura:</b> Sujeto + <code>donâ€™t/doesnâ€™t</code> + verbo base + complemento.</p>
        <ul class="grid sm:grid-cols-2 gap-3">
          <li class="p-3 bg-white rounded border flex items-center justify-between">
            <span>I <u>donâ€™t</u> ride a motorbike.</span>
            <button class="speak-btn bg-green-600 text-white rounded px-3 py-1" onclick="speak('I do not ride a motorbike')">ğŸ”Š</button>
          </li>
          <li class="p-3 bg-white rounded border flex items-center justify-between">
            <span>She <u>doesnâ€™t</u> check email at night.</span>
            <button class="speak-btn bg-green-600 text-white rounded px-3 py-1" onclick="speak('She does not check email at night')">ğŸ”Š</button>
          </li>
        </ul>
        <div class="mt-3 text-slate-600 text-sm">ğŸ§  Recuerda: con <b>doesnâ€™t</b> el verbo queda en su forma base (no lleva -s).</div>
      </div>

      <div class="mb-6">
        <h3 class="text-xl font-bold text-green-700 mb-2">3) Preguntas (Yes/No y Wh-)</h3>
        <p class="text-slate-700 mb-2"><b>Estructura:</b> <code>Do/Does</code> + sujeto + verbo base + complemento?</p>
        <ul class="grid sm:grid-cols-2 gap-3">
          <li class="p-3 bg-white rounded border flex items-center justify-between">
            <span><b>Do</b> you study programming?</span>
            <button class="speak-btn bg-green-600 text-white rounded px-3 py-1" onclick="speak('Do you study programming?')">ğŸ”Š</button>
          </li>
          <li class="p-3 bg-white rounded border flex items-center justify-between">
            <span><b>Does</b> he go to class in BerÃ¡stegui?</span>
            <button class="speak-btn bg-green-600 text-white rounded px-3 py-1" onclick="speak('Does he go to class in Berastegui?')">ğŸ”Š</button>
          </li>
        </ul>
        <div class="mt-3 text-slate-600 text-sm">â“ Wh-: <i>Where do you study?</i> / <i>When does she have lunch?</i></div>
      </div>

      <!-- Chequeo rÃ¡pido -->
      <div class="bg-white border-l-4 border-green-500 rounded-lg shadow-sm p-4 sm:p-6">
        <h4 class="text-lg font-bold text-green-700 mb-2">Chequeo rÃ¡pido</h4>
        <div id="micro-quiz" class="space-y-3"></div>
        <button id="micro-quiz-btn" class="mt-4 bg-green-600 text-white font-semibold py-2 px-4 rounded hover:bg-green-700">Comprobar</button>
        <div id="micro-quiz-res" class="mt-3 font-medium"></div>
      </div>
    </section>

    <!-- Actividades -->
    <section id="actividades" class="content-pane">
      <h2 class="text-2xl sm:text-3xl font-bold text-green-800 mb-6">Actividades</h2>

      <!-- Drag & Drop: Affirmative / Negative / Question -->
      <div class="bg-white border-l-4 border-green-500 rounded-lg shadow-sm p-6 mb-6">
        <h3 class="text-xl font-bold text-green-700 mb-2">1) Clasifica las oraciones</h3>
        <p class="text-slate-600 mb-4">Arrastra cada oraciÃ³n a su categorÃ­a: <b>Afirmativa</b>, <b>Negativa</b> o <b>Pregunta</b>.</p>
        <div class="grid md:grid-cols-2 gap-4">
          <div id="drag-bank" class="grid grid-cols-1 gap-2"></div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
            <div class="drop-zone p-3 bg-green-50 border rounded" data-type="Affirmative"><b>Afirmativa</b></div>
            <div class="drop-zone p-3 bg-green-50 border rounded" data-type="Negative"><b>Negativa</b></div>
            <div class="drop-zone p-3 bg-green-50 border rounded" data-type="Question"><b>Pregunta</b></div>
          </div>
        </div>
        <button id="check-sort" class="mt-4 bg-green-600 text-white font-semibold py-2 px-4 rounded hover:bg-green-700">Verificar</button>
        <div id="sort-result" class="mt-3 font-medium"></div>
      </div>

      <!-- True/False with feedback -->
      <div class="bg-white border-l-4 border-green-500 rounded-lg shadow-sm p-6 mb-6">
        <h3 class="text-xl font-bold text-green-700 mb-2">2) Verdadero o Falso</h3>
        <p class="text-slate-600 mb-3">Marca V o F y lee la explicaciÃ³n.</p>
        <div id="tf-list" class="space-y-3"></div>
        <button id="check-tf" class="mt-3 bg-green-600 text-white font-semibold py-2 px-4 rounded hover:bg-green-700">Comprobar</button>
        <div id="tf-result" class="mt-3 font-medium"></div>
      </div>

      <!-- Cloze -->
      <div class="bg-white border-l-4 border-green-500 rounded-lg shadow-sm p-6 mb-6">
        <h3 class="text-xl font-bold text-green-700 mb-2">3) Completa con donâ€™t / doesnâ€™t / do / does</h3>
        <div id="cloze-list" class="space-y-3"></div>
        <button id="check-cloze" class="mt-4 bg-green-600 text-white font-semibold py-2 px-4 rounded hover:bg-green-700">Comprobar</button>
        <div id="cloze-result" class="mt-3 font-medium"></div>
      </div>

      <!-- Ordering -->
      <div class="bg-white border-l-4 border-green-500 rounded-lg shadow-sm p-6 mb-6">
        <h3 class="text-xl font-bold text-green-700 mb-2">4) Ordena la pregunta</h3>
        <p class="text-slate-600 mb-3">Arrastra las palabras para formar preguntas correctas.</p>
        <div id="order-list" class="space-y-4"></div>
        <button id="check-order" class="mt-4 bg-green-600 text-white font-semibold py-2 px-4 rounded hover:bg-green-700">Comprobar</button>
        <div id="order-result" class="mt-3 font-medium"></div>
      </div>

      <!-- Speaking -->
      <div class="bg-white border-l-4 border-green-500 rounded-lg shadow-sm p-6">
        <h3 class="text-xl font-bold text-green-700 mb-2">5) Speaking: preguntas y respuestas</h3>
        <p class="text-slate-600 mb-3">Graba un audio (45â€“60 s) respondiendo <b>3 preguntas</b> y diciendo <b>3 oraciones</b> en tercera persona:</p>
        <ul class="list-disc ml-6 text-slate-700">
          <li>What time do you wake up?</li>
          <li>Do you study programming in the evening?</li>
          <li>Where do you have lunch?</li>
          <li><i>He studies in Lorica.</i></li>
          <li><i>She goes to class on Mondays.</i></li>
          <li><i>It starts at 8 a.m.</i></li>
        </ul>
        <div class="flex items-center gap-3 mt-3">
          <button id="rec-start" class="bg-green-600 text-white font-semibold py-2 px-4 rounded hover:bg-green-700">ğŸ™ï¸ Iniciar</button>
          <button id="rec-stop" class="bg-slate-600 text-white font-semibold py-2 px-4 rounded hover:bg-slate-700" disabled>â¹ï¸ Detener</button>
          <span id="rec-status" class="text-slate-600"></span>
        </div>
        <div id="rec-audio" class="mt-4"></div>
      </div>
    </section>

    <!-- EvaluaciÃ³n -->
    <section id="evaluacion" class="content-pane">
      <h2 class="text-2xl sm:text-3xl font-bold text-green-800 mb-6">EvaluaciÃ³n</h2>
      <div class="bg-white p-6 rounded-lg shadow-md">
        <p class="text-slate-600 mb-4">Responde todas las preguntas. Tienes Ã­tems de selecciÃ³n mÃºltiple, completar y producciÃ³n.</p>
        <div id="quiz-container" class="space-y-6"></div>
        <button id="submit-quiz-btn" class="mt-2 bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700">Finalizar evaluaciÃ³n</button>
        <button id="reset-quiz-btn" class="mt-2 ml-2 bg-slate-100 text-slate-800 font-semibold py-2 px-6 rounded-lg hover:bg-slate-200">Reintentar</button>
        <div id="quiz-result" class="mt-4 text-lg font-bold"></div>

        <!-- ProducciÃ³n escrita -->
        <div class="mt-8 border-t pt-6">
          <h3 class="text-xl font-bold text-green-700 mb-2">ProducciÃ³n escrita</h3>
          <p class="text-slate-600 mb-2">Escribe un pÃ¡rrafo (6â€“8 oraciones) con: 3 afirmativas, 2 negativas y 1 pregunta sobre tu rutina.</p>
          <textarea id="writing" class="w-full border rounded p-3" rows="6" placeholder="Ej.: I wake up at 6. I study programming at night. I donâ€™t go to class on Sundays..."></textarea>
          <div class="text-sm text-slate-500 mt-2">GuÃ¡rdalo o copia/pega en tu plataforma para envÃ­o.</div>
        </div>
      </div>
    </section>

    <!-- Recursos -->
    <section id="recursos" class="content-pane">
      <h2 class="text-2xl sm:text-3xl font-bold text-green-800 mb-6">Recursos para profundizar</h2>
      <ul class="space-y-4">
        <li class="bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500">
          <h3 class="font-bold text-green-700">British Council â€“ Present Simple</h3>
          <a class="underline text-slate-700 hover:text-green-700" href="https://learnenglish.britishcouncil.org/grammar/a1-a2-grammar/present-simple" target="_blank">Ir al recurso</a>
        </li>
        <li class="bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500">
          <h3 class="font-bold text-green-700">YouGlish â€“ PronunciaciÃ³n</h3>
          <a class="underline text-slate-700 hover:text-green-700" href="https://youglish.com/" target="_blank">Ir al recurso</a>
        </li>
      </ul>
    </section>

    <!-- BibliografÃ­a -->
    <section id="bibliografia" class="content-pane">
      <h2 class="text-2xl sm:text-3xl font-bold text-green-800 mb-6">BibliografÃ­a</h2>
      <div class="space-y-6">
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
          <span class="block text-slate-700">Flores Kastanis, P. (2016). <i>English 1</i> (2.Âª ed.). Grupo Editorial Patria.</span>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
          <span class="block text-slate-700">Pulido MÃ©ndez, P. (2022). <i>ComunicaciÃ³n en lenguas extranjeras (inglÃ©s) N2: FCOV05</i>. Editorial Tutor FormaciÃ³n.</span>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
          <span class="block text-slate-700">British Council. (2023). <i>Present Simple</i>. https://learnenglish.britishcouncil.org</span>
        </div>
      </div>

      <footer class="mt-12 pt-6 border-t-2 border-slate-200 text-center">
        <p class="text-slate-600 font-medium">Creado para estudiantes de TÃ©cnico Profesional en ProgramaciÃ³n Web</p>
        <p class="text-green-800 font-bold text-lg">Universidad de CÃ³rdoba â€” MonterÃ­a, Lorica, SahagÃºn, BerÃ¡stegÃ¼i, MontelÃ­bano</p>
      </footer>
    </section>
  </main>
</div>

<script>
/* ===== NavegaciÃ³n panes ===== */
document.addEventListener('DOMContentLoaded', () => {
  const links = document.querySelectorAll('.sidebar-link');
  const panes = document.querySelectorAll('.content-pane');
  const mobile = document.getElementById('mobile-nav');

  function switchPane(id){
    panes.forEach(p=>p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    links.forEach(l=>l.classList.toggle('active', l.dataset.target===id));
    if(mobile && mobile.value!==id) mobile.value=id;
  }
  links.forEach(l=>l.addEventListener('click', e=>{
    e.preventDefault();
    switchPane(l.dataset.target);
  }));
  mobile && mobile.addEventListener('change', e=>switchPane(e.target.value));
});

/* ===== TTS ===== */
function speak(text){
  try{
    const u=new SpeechSynthesisUtterance(text);
    u.lang='en-US';
    speechSynthesis.speak(u);
  }catch(e){
    alert('Tu navegador no permite pronunciaciÃ³n automÃ¡tica.');
  }
}

/* ===== Micro quiz ===== */
const MICRO_Q = [
  {q:'Selecciona la forma afirmativa correcta:', opts:['She study programming.','She studies programming.','She studying programming.','She is study programming.'], a:'She studies programming.'},
  {q:'Elige la negativa correcta:', opts:['He doesnâ€™t goes to class.','He donâ€™t go to class.','He doesnâ€™t go to class.','He not go to class.'], a:'He doesnâ€™t go to class.'},
  {q:'Pregunta correcta:', opts:['Does she go to class?','Do she goes to class?','Does she goes to class?','She does go to class?'], a:'Does she go to class?'}
];
function renderMicroQuiz(){
  const c=document.getElementById('micro-quiz'); if(!c) return;
  c.innerHTML='';
  MICRO_Q.forEach((item,i)=>{
    const block=document.createElement('div');
    block.className='p-3 border rounded';
    let opts='';
    item.opts.forEach(o=>{
      opts += `<div class="quiz-option p-2 border-2 border-slate-200 rounded cursor-pointer" data-value="${o}">${o}</div>`;
    });
    block.innerHTML=`
      <p class="font-medium text-slate-800 mb-2">${i+1}. ${item.q}</p>
      <div class="space-y-2">${opts}</div>
      <div class="quiz-feedback mt-2 text-sm"></div>
    `;
    block.querySelectorAll('.quiz-option').forEach(opt=>{
      opt.addEventListener('click',()=>{
        block.querySelectorAll('.quiz-option').forEach(el=>el.classList.remove('selected'));
        opt.classList.add('selected');
      });
    });
    c.appendChild(block);
  });
}
renderMicroQuiz();
document.getElementById('micro-quiz-btn')?.addEventListener('click',()=>{
  const blocks=document.querySelectorAll('#micro-quiz > div');
  let score=0;
  blocks.forEach((b,idx)=>{
    const sel=b.querySelector('.quiz-option.selected');
    const fb=b.querySelector('.quiz-feedback');
    if(sel && sel.dataset.value===MICRO_Q[idx].a){
      score++; fb.innerHTML = `<span class="text-green-700 font-semibold">âœ”ï¸ Correcto</span>`;
    }else{
      fb.innerHTML = `<span class="text-red-700 font-semibold">âŒ Revisa la regla.</span>`;
    }
  });
  const res=document.getElementById('micro-quiz-res');
  res.textContent=`Puntaje: ${score} / ${MICRO_Q.length}`;
  res.className = score===MICRO_Q.length ? 'mt-3 font-medium text-green-700' : 'mt-3 font-medium text-red-700';
});

/* ===== Drag & Drop: clasificar ===== */
const SORT_ITEMS = [
  {text:'I study programming at night.', type:'Affirmative'},
  {text:'She studies in Lorica.', type:'Affirmative'},
  {text:'We donâ€™t go to class on Sundays.', type:'Negative'},
  {text:'He doesnâ€™t check email at night.', type:'Negative'},
  {text:'Do you study programming?', type:'Question'},
  {text:'Does he go to class in BerÃ¡stegui?', type:'Question'}
];
function renderSort(){
  const drag=document.getElementById('drag-bank'); if(!drag) return;
  drag.innerHTML='';
  SORT_ITEMS.forEach(s=>{
    const el=document.createElement('div');
    el.className='drag-item p-2 bg-white border rounded pill';
    el.draggable=true; el.textContent=s.text; el.dataset.type=s.type;
    el.addEventListener('dragstart',e=>{e.dataTransfer.setData('text/plain',s.text); e.dataTransfer.setData('type',s.type);});
    drag.appendChild(el);
  });
  document.querySelectorAll('.drop-zone').forEach(dz=>{
    dz.addEventListener('dragover',e=>e.preventDefault());
    dz.addEventListener('drop',e=>{
      e.preventDefault();
      const txt=e.dataTransfer.getData('text/plain');
      const t=e.dataTransfer.getData('type');
      const tag=document.createElement('div');
      tag.className='px-2 py-1 bg-white rounded border text-slate-700 mt-1';
      tag.textContent=txt;
      tag.dataset.type=t;
      dz.appendChild(tag);
    });
  });
}
renderSort();
document.getElementById('check-sort')?.addEventListener('click',()=>{
  const zones=document.querySelectorAll('.drop-zone');
  let ok=0, total=0;
  zones.forEach(z=>{
    [...z.querySelectorAll('div')].forEach(child=>{
      if(child.dataset && child.dataset.type){ total++; }
      const correct = child.dataset?.type===z.dataset.type;
      child.style.borderColor = correct ? '#22c55e' : '#ef4444';
      if(correct) ok++;
    });
  });
  const res=document.getElementById('sort-result');
  res.textContent=`Correctas: ${ok} / ${total}`;
  res.className = ok===total ? 'mt-3 font-medium text-green-700' : 'mt-3 font-medium text-red-700';
});

/* ===== True/False ===== */
const TF = [
  {stmt:'Con he/she/it el verbo lleva -s (o -es/-ies).', ans:true, exp:'Ej.: She studies, He goes.'},
  {stmt:'Para negar con she se usa "donâ€™t".', ans:false, exp:'Se usa "doesnâ€™t" + verbo base.'},
  {stmt:'Las preguntas con you usan "Does".', ans:false, exp:'Con you â†’ Do you...?'},
  {stmt:'Con doesnâ€™t el verbo va con -s.', ans:false, exp:'Nunca: siempre va en forma base.'}
];
function renderTF(){
  const c=document.getElementById('tf-list'); if(!c) return;
  c.innerHTML='';
  TF.forEach((row,i)=>{
    const div=document.createElement('div');
    div.className='p-3 border rounded flex items-center justify-between gap-3';
    div.innerHTML=`
      <div class="flex-1">${i+1}. ${row.stmt}</div>
      <div class="flex items-center gap-2">
        <label class="flex items-center gap-1"><input type="radio" name="tf-${i}" value="true"/> V</label>
        <label class="flex items-center gap-1"><input type="radio" name="tf-${i}" value="false"/> F</label>
      </div>
      <div class="text-sm text-slate-500 tf-exp"></div>
    `;
    c.appendChild(div);
  });
}
renderTF();
document.getElementById('check-tf')?.addEventListener('click',()=>{
  const rows=[...document.querySelectorAll('#tf-list > div')];
  let ok=0;
  rows.forEach((r,i)=>{
    const val=(r.querySelector('input[type=radio]:checked')||{}).value;
    const exp=r.querySelector('.tf-exp');
    if(String(TF[i].ans)===val){ ok++; exp.innerHTML='<span class="text-green-700 font-semibold">âœ”ï¸ Correcto.</span> '+TF[i].exp; }
    else{ exp.innerHTML='<span class="text-red-700 font-semibold">âŒ Revisa.</span> '+TF[i].exp; }
  });
  const res=document.getElementById('tf-result');
  res.textContent=`Correctas: ${ok} / ${TF.length}`;
  res.className = ok===TF.length ? 'mt-3 font-medium text-green-700' : 'mt-3 font-medium text-red-700';
});

/* ===== Cloze do/does/donâ€™t/doesnâ€™t ===== */
const CLOZE = [
  {text:'___ you study programming in the evening?', answer:'Do'},
  {text:'He ___ go to class on Sundays.', answer:"doesnâ€™t"},
  {text:'She ___ check email at night.', answer:"doesnâ€™t"},
  {text:'___ she live in Lorica?', answer:'Does'},
  {text:'We ___ ride a motorbike to class.', answer:"donâ€™t"}
];
function renderCloze(){
  const c=document.getElementById('cloze-list'); if(!c) return;
  c.innerHTML='';
  CLOZE.forEach((row,i)=>{
    const div=document.createElement('div');
    div.className='p-3 border rounded';
    div.innerHTML=`
      <label class="block mb-2 text-slate-800">${i+1}. ${row.text.replace('___', '<input class="cloze-input border rounded px-2 py-1 w-28" data-answer="'+row.answer+'">')}</label>
      <div class="text-sm text-slate-500">Pista: Do/Does/ donâ€™t/ doesnâ€™t</div>
    `;
    c.appendChild(div);
  });
}
renderCloze();
document.getElementById('check-cloze')?.addEventListener('click',()=>{
  const inputs=document.querySelectorAll('.cloze-input');
  let ok=0;
  inputs.forEach(inp=>{
    const val=inp.value.trim().toLowerCase();
    const ans=inp.dataset.answer.toLowerCase();
    const correct = val===ans;
    inp.style.borderColor = correct ? '#22c55e' : '#ef4444';
    if(correct) ok++;
  });
  const res=document.getElementById('cloze-result');
  res.textContent = `Correctas: ${ok} / ${inputs.length}`;
  res.className = ok===inputs.length ? 'mt-3 font-medium text-green-700' : 'mt-3 font-medium text-red-700';
});

/* ===== Ordering preguntas ===== */
const ORDER_ITEMS = [
  {tokens:['Do','you','study','programming','at','night','?'], solution:'Do you study programming at night ?'},
  {tokens:['Does','she','go','to','class','on','Mondays','?'], solution:'Does she go to class on Mondays ?'},
  {tokens:['Where','do','you','have','lunch','?'], solution:'Where do you have lunch ?'}
];
function renderOrdering(){
  const c=document.getElementById('order-list'); if(!c) return;
  c.innerHTML='';
  ORDER_ITEMS.forEach((row,idx)=>{
    const box=document.createElement('div');
    box.className='p-3 border rounded';
    const bin=document.createElement('div');
    bin.className='token-bin flex flex-wrap gap-2 p-2 bg-green-50 rounded';
    bin.dataset.index=idx;

    const pool=document.createElement('div');
    pool.className='flex flex-wrap gap-2 p-2 mt-2 bg-white rounded border';
    row.tokens.forEach(t=>{
      const tok=document.createElement('span');
      tok.className='sortable-token select-none px-3 py-1 bg-white rounded border shadow-sm';
      tok.textContent=t;
      tok.draggable=true;
      tok.addEventListener('dragstart',e=>{
        e.dataTransfer.setData('text/plain',t);
        e.dataTransfer.setData('source','pool');
      });
      pool.appendChild(tok);
    });

    bin.addEventListener('dragover',e=>e.preventDefault());
    bin.addEventListener('drop',e=>{
      e.preventDefault();
      const text=e.dataTransfer.getData('text/plain');
      const lbl=document.createElement('span');
      lbl.className='px-3 py-1 bg-white rounded border';
      lbl.textContent=text;
      lbl.draggable=true;
      lbl.addEventListener('dragstart',ev=>{
        ev.dataTransfer.setData('text/plain',text);
        ev.dataTransfer.setData('source','bin');
      });
      bin.appendChild(lbl);
    });

    pool.addEventListener('dragover',e=>e.preventDefault());
    pool.addEventListener('drop',e=>{
      e.preventDefault();
      const text=e.dataTransfer.getData('text/plain');
      const from=e.dataTransfer.getData('source');
      if(from==='bin'){
        const lbl=[...bin.children].find(el=>el.textContent===text);
        if(lbl){ pool.appendChild(lbl); }
      }
    });

    box.innerHTML=`<p class="font-medium text-slate-800 mb-2">${idx+1}. Forma la pregunta correcta</p>`;
    box.appendChild(bin);
    box.appendChild(pool);
    c.appendChild(box);
  });
}
renderOrdering();

document.getElementById('check-order')?.addEventListener('click',()=>{
  const bins=document.querySelectorAll('.token-bin');
  let ok=0;
  bins.forEach((bin,i)=>{
    const formed=[...bin.children].map(el=>el.textContent).join(' ');
    const sol=ORDER_ITEMS[i].solution;
    const correct = formed.trim()===sol.trim();
    bin.style.border = correct ? '2px solid #22c55e' : '2px solid #ef4444';
    if(correct) ok++;
  });
  const res=document.getElementById('order-result');
  res.textContent = `Correctas: ${ok} / ${bins.length}`;
  res.className = ok===bins.length ? 'mt-3 font-medium text-green-700' : 'mt-3 font-medium text-red-700';
});

/* ===== Speaking recorder ===== */
let mediaRecorder, chunks=[];
const startBtn=document.getElementById('rec-start');
const stopBtn=document.getElementById('rec-stop');
const statusEl=document.getElementById('rec-status');
const outEl=document.getElementById('rec-audio');

startBtn?.addEventListener('click', async ()=>{
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    mediaRecorder=new MediaRecorder(stream);
    chunks=[];
    mediaRecorder.ondataavailable=e=>{ if(e.data.size>0) chunks.push(e.data); };
    mediaRecorder.onstop=()=>{
      const blob=new Blob(chunks,{type:'audio/webm'});
      const url=URL.createObjectURL(blob);
      outEl.innerHTML = `
        <audio controls class="w-full mt-2"><source src="${url}" type="audio/webm"></audio>
        <a class="inline-block mt-2 underline text-green-700" href="${url}" download="simple_present_speaking.webm">Descargar audio</a>
      `;
    };
    mediaRecorder.start();
    startBtn.disabled=true; stopBtn.disabled=false;
    statusEl.textContent='Grabando... responde y di 3 oraciones en tercera persona.';
  }catch(e){
    alert('No se pudo acceder al micrÃ³fono. Revisa permisos del navegador.');
  }
});
stopBtn?.addEventListener('click', ()=>{
  if(mediaRecorder && mediaRecorder.state!=='inactive'){
    mediaRecorder.stop();
    startBtn.disabled=false; stopBtn.disabled=true;
    statusEl.textContent='GrabaciÃ³n detenida.';
  }
});

/* ===== EvaluaciÃ³n (18 Ã­tems) ===== */
const QUIZ = [
  {type:'mcq', q:'Elige la afirmativa correcta:', opts:['He go to class.','He goes to class.','He going to class.','He is go to class.'], a:'He goes to class.', ok:'Correcto.', ko:'Tercera persona: goes.'},
  {type:'mcq', q:'Negativa correcta:', opts:['She donâ€™t study.','She doesnâ€™t study.','She doesnâ€™t studies.','She not study.'], a:'She doesnâ€™t study.', ok:'Bien.', ko:'Con doesnâ€™t el verbo va base.'},
  {type:'mcq', q:'Pregunta Yes/No correcta:', opts:['Do she study?','Does she study?','Does she studies?','She does study?'], a:'Does she study?', ok:'Exacto.', ko:'Does + sujeto + base.'},
  {type:'mcq', q:'Completa: They ___ programming at night.', opts:['study','studies','is study','are study'], a:'study', ok:'Correcto.', ko:'They + verbo base.'},
  {type:'mcq', q:'Completa: He ___ lunch at noon.', opts:['have','has','having','haves'], a:'has', ok:'Muy bien.', ko:'He/She/It â†’ has.'},
  {type:'mcq', q:'Traduce: "Â¿DÃ³nde estudias?"', opts:['Where do you study?','Where you study?','Where are you study?','Where does you study?'], a:'Where do you study?', ok:'Correcto.', ko:'Wh- + do + you.'},
  {type:'mcq', q:'Selecciona la negativa correcta:', opts:['We doesnâ€™t go to class.','We donâ€™t go to class.','We not go to class.','We doesnâ€™t goes to class.'], a:'We donâ€™t go to class.', ok:'Bien.', ko:'We â†’ donâ€™t.'},
  {type:'mcq', q:'Interrogativa correcta para BerÃ¡stegÃ¼i:', opts:['Does he go to class in BerÃ¡stegÃ¼i?','Do he go to class in BerÃ¡stegÃ¼i?','Does he goes to class in BerÃ¡stegÃ¼i?','He does go to class in BerÃ¡stegÃ¼i?'], a:'Does he go to class in BerÃ¡stegÃ¼i?', ok:'Perfecto.', ko:'Does + go (base).'},
  {type:'mcq', q:'Completa: She ___ programming videos at night.', opts:['watch','watches','watchs','is watch'], a:'watches', ok:'Correcto.', ko:'Add -es after ch.'},
  {type:'mcq', q:'Traduce: "Nosotros no estudiamos los domingos."', opts:['We donâ€™t study on Sundays.','We doesnâ€™t study on Sundays.','We not study on Sundays.','We do not studies on Sundays.'], a:'We donâ€™t study on Sundays.', ok:'Muy bien.', ko:'We â†’ donâ€™t + base.'},
  {type:'mcq', q:'Elige la mejor opciÃ³n:', opts:['I studies programming.','I study programming.','I study programmings.','I am study programming.'], a:'I study programming.', ok:'Correcto.', ko:'I + base form.'},
  {type:'mcq', q:'Traduce: "Â¿A quÃ© hora almuerzas?"', opts:['What time you have lunch?','What time do you have lunch?','At what time do you has lunch?','When do you has lunch?'], a:'What time do you have lunch?', ok:'Bien.', ko:'Do you have (no has).'},
  // Cloze dentro del banco
  {type:'cloze', q:'___ you check email at night?', a:'Do', ok:'Correcto.', ko:'Con you: Do.'},
  {type:'cloze', q:'He ___ go to class on Sundays.', a:"doesnâ€™t", ok:'Bien.', ko:'He â†’ doesnâ€™t + base.'},
  {type:'cloze', q:'___ she study in Lorica?', a:'Does', ok:'Perfecto.', ko:'She â†’ Does.'},
  {type:'cloze', q:'We ___ wake up at 6 a.m.', a:"donâ€™t", ok:'Correcto.', ko:'We â†’ donâ€™t.'},
  {type:'cloze', q:'She ___ lunch at noon.', a:'has', ok:'Exacto.', ko:'She â†’ has.'},
  {type:'mcq', q:'Selecciona la opciÃ³n natural:', opts:['Do you study programming at night?','Are you study programming at night?','You study programming at night do?','Do you studies programming at night?'], a:'Do you study programming at night?', ok:'Excelente.', ko:'Do + you + base.'}
];

function renderQuiz(){
  const c=document.getElementById('quiz-container'); if(!c) return;
  c.innerHTML='';
  QUIZ.forEach((item,idx)=>{
    const block=document.createElement('div');
    block.className='p-4 border rounded';
    if(item.type==='mcq'){
      let optionsHTML='';
      item.opts.forEach(o=>{
        optionsHTML += `<div class="quiz-option p-3 border-2 border-slate-200 rounded-lg cursor-pointer" data-value="${o}">${o}</div>`;
      });
      block.innerHTML = `
        <p class="font-semibold mb-2">${idx+1}. ${item.q}</p>
        <div class="space-y-2">${optionsHTML}</div>
        <div class="quiz-feedback mt-2 text-sm"></div>
      `;
      block.querySelectorAll('.quiz-option').forEach(opt=>{
        opt.addEventListener('click',()=>{
          block.querySelectorAll('.quiz-option').forEach(el=>el.classList.remove('selected'));
          opt.classList.add('selected');
        });
      });
    }else if(item.type==='cloze'){
      block.innerHTML = `
        <p class="font-semibold mb-2">${idx+1}. ${item.q.replace('___', '<input class="quiz-cloze border rounded px-2 py-1 w-28" data-answer="'+item.a+'">')}</p>
        <div class="quiz-feedback mt-2 text-sm"></div>
      `;
    }
    c.appendChild(block);
  });
}
renderQuiz();

document.getElementById('submit-quiz-btn')?.addEventListener('click',()=>{
  const blocks=[...document.querySelectorAll('#quiz-container > div')];
  let score=0, total=QUIZ.length;
  blocks.forEach((b,i)=>{
    const item=QUIZ[i];
    const fb=b.querySelector('.quiz-feedback');
    if(item.type==='mcq'){
      const sel=b.querySelector('.quiz-option.selected');
      if(sel && sel.dataset.value===item.a){
        score++; fb.innerHTML=`<span class="text-green-700 font-semibold">âœ”ï¸ ${item.ok}</span>`;
      }else{
        fb.innerHTML=`<span class="text-red-700 font-semibold">âŒ ${item.ko}</span>`;
      }
    }else{
      const inp=b.querySelector('.quiz-cloze');
      if(inp && inp.value.trim().toLowerCase()===String(item.a).toLowerCase()){
        score++; fb.innerHTML=`<span class="text-green-700 font-semibold">âœ”ï¸ ${item.ok}</span>`;
        inp.style.borderColor='#22c55e';
      }else{
        fb.innerHTML=`<span class="text-red-700 font-semibold">âŒ ${item.ko}</span>`;
        if(inp) inp.style.borderColor='#ef4444';
      }
    }
  });
  const res=document.getElementById('quiz-result');
  res.textContent = `Tu puntuaciÃ³n es: ${score} de ${total}.`;
  res.className = score/total>=0.7 ? 'mt-4 text-lg font-bold text-green-700' : 'mt-4 text-lg font-bold text-red-700';
});
document.getElementById('reset-quiz-btn')?.addEventListener('click',()=>{
  renderQuiz();
  document.getElementById('quiz-result').textContent='';
});
</script>
</body>
</html>
